## SpDB Manual

### **æ¦‚è¿°**
**SpDB**æ˜¯ä¸€ä¸ªè‡ªä¸»å¼€å‘çš„Pythonåº“ï¼Œç”¨äºå¤„ç†EASTæ•°æ®åˆ†æä¸­æ¶‰åŠçš„å¤šç§ç§‘å­¦æ•°æ®æ ¼å¼ã€‚å®ƒä»¥MAS IDSä¸ºæ ‡å‡†è§„èŒƒçš„æœ¬ä½“ï¼Œå¼•å…¥æ•°æ®é›†æˆçš„æ€æƒ³å°†ä»¥ä¸åŒè¯­ä¹‰å’Œæ ¼å¼å­˜å‚¨çš„æ•°æ®åœ¨ç»Ÿä¸€çš„æ•°æ®æ¨¡å‹ä¸‹è¿›è¡Œæ£€ç´¢ã€æŸ¥è¯¢ã€‚

**SpDB**ä¸“é—¨ä¸ºé›†æˆå»ºæ¨¡åˆ†æç³»ç»ŸFyTokçš„æ•°æ®äº¤äº’è€Œè®¾è®¡ï¼Œä½†æ˜¯ä¸ä¸€å®šä¸ä¹‹ç»‘å®šï¼Œç‹¬ç«‹äºFyTokä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚

**SpDB**å¯ä»¥ä¸ºç”¨æˆ·æä¾›ï¼š
- ä»¥IMAS IDSä¸ºæ ‡å‡†çš„æ•°æ®äº¤äº’è¯­ä¹‰ï¼Œå°†æ•°æ®ç»‘å®šåˆ° IMAS DDï¼Œä»¥ä¾¿åœ¨ IMAS DD åç§°ç©ºé—´ä¸‹ç»Ÿä¸€å¼‚æ„å¤šæºæ•°æ®ã€‚ä½†æ˜¯ä¸ä¾èµ–äºIMAS ï¼Œä¸éœ€è¦å®‰è£…IMAS ã€‚
- ç‹¬ç«‹çš„pythonåŒ…ï¼Œæ˜“å®‰è£…ã€ä¸Šæ‰‹ã€‚å¯ç‹¬ç«‹äºShenMaé›†ç¾¤è¿è¡Œï¼Œå®‰è£…åœ¨ä»»ä½•æœ‰python3.10+çš„ç¯å¢ƒä¸‹
- å›Šæ‹¬æ—¥å¸¸ç§‘ç ”å·¥ä½œä¸­å¸¸ç”¨æ•°æ®æ ¼å¼çš„å¤„ç†ï¼Œä¸”ä»¥æ’ä»¶å½¢å¼ç®¡ç†ï¼Œå¼€å‘è€…ç”¨æˆ·æ˜“å¯¹å…¶è¿›è¡Œæ‰©å±•
- è¯»å–çš„æ•°æ®åœ¨å†…å­˜ä¸­ä»¥Pythonä¸­æ•°æ®æ ¼å¼è¿›è¡Œäº¤äº’ï¼Œå…¶æ•°æ®çš„è¯­ä¹‰æ˜¯ä¸¥æ ¼éµå®ˆIMAS IDSçš„æ ‘çŠ¶ç»“æ„
- å†™æ•°æ®æ˜¯çµæ´»çš„ã€‚

### **SpDBçš„è®¾è®¡æ€æƒ³**
**SpDB**æ˜¯ä¸€ä¸ªæ•°æ®é›†æˆå·¥å…·ã€‚å®ƒåŸºäºæ ‡å‡†çš„æ•°æ®æ¨¡å‹ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ç§å…¨å±€çš„ä¸­ä»‹æ¨¡å¼ï¼Œå°†æ¥è‡ªä¸åŒã€å¼‚æ„çš„æ•°æ®æºé›†æˆåˆ°ä¸€ä¸ªå…¨å±€çš„åœ°å€ç©ºé—´ï¼Œé€šè¿‡å”¯ä¸€çš„URIå®ç°å¯¹æ•°æ®çš„ç»Ÿä¸€è®¿é—®ï¼Œå³æ˜¯æ•°æ®é›†æˆç ”ç©¶çš„èŒƒç•´ã€‚å®ƒçš„å®ç°ï¼ŒåŒ…å«ä¸‰å±‚æ„æ¶ï¼šé¢å‘ç”¨æˆ·çš„ç»Ÿä¸€è®¿é—®å±‚åŠåº•å±‚çš„æ˜ å°„å±‚å’Œè½¬åŒ–å±‚ã€‚


<img src="./figures/three-layer_spdb.png" width = "500" height = "400" alt="/three-layer" align=center />

### **SpDBçš„å¤„ç†å¯¹è±¡**

**SpDB**æ˜¯ä¸€ä¸ªé€šç”¨çš„æ•°æ®é›†æˆå·¥å…·ï¼Œæ„åœ¨å°†èšå˜ç ”ç©¶ä¸­å¸¸ç”¨çš„æ•°æ®æ ¼å¼éƒ½ç»Ÿä¸€æ˜ å°„åœ¨æ ‡å‡†çš„è¯­ä¹‰è¡¨è¿°ä¸‹ï¼ŒåŒæ—¶é™ä½ç”¨æˆ·å¤„ç†å¯¹ä¸åŒæ ¼å¼çš„æ•°æ®æºçš„é—¨æ§›ã€‚
**SpDB**å¯ä»¥å¤„ç†å¸¸ç”¨çš„å¤šç§ç±»å‹çš„ç§‘å­¦æ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬ï¼š
- PythonåŸç”Ÿçš„æ•°æ®æ ¼å¼ï¼šå­—å…¸ã€Listã€‚
    - ç›´æ¥åœ¨å†…å­˜ä¸­äº¤äº’
- åŠç»“æ„åŒ–æ•°æ®ç»“æ„ï¼Œå¦‚ï¼šNamelistã€JSONã€XMLã€HDF5ã€netCDFç­‰ã€‚
    - æŒ‰ç…§åŠç»“æ„åŒ–æ•°æ®çš„å·²æœ‰çš„æ ‘çŠ¶è·¯å¾„æŸ¥è¯¢
- ç»“æ„åŒ–æ•°æ®ç»“æ„ï¼Œå¦‚ï¼šGdskfileï¼Œã€Inputfileç­‰ã€‚
    - æ•°æ®é‡æ¯”è¾ƒå°ï¼Œæ‹¿å›æ¥å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥è®¿é—®ã€‚
- è¿œç¨‹æ•°æ®åº“ç³»ç»Ÿï¼Œå¦‚EASTå®éªŒçš„MDSplusåŠCFETRè®¾è®¡çš„MDSplusæ•°æ®åº“ç­‰ã€‚
    - å°†åŸå§‹çš„æ•°æ®æºæ˜ å°„åœ¨æ ‡å‡†çš„æ ‘çŠ¶ç»“æ„çš„è¯­ä¹‰ä¸‹ã€‚
    - æ”¯æŒå»¶è¿Ÿæ‰§è¡Œ
    - æ”¯æŒä¸åŒç±»å‹æ•°æ®çš„é›†æˆï¼Œç»Ÿä¸€çš„å…¥å£è®¿é—®ã€‚
        - é™æ€è£…ç½®æè¿°æ•°æ®
        - åŠ¨æ€å®éªŒæµ‹é‡æ•°æ®

#### **SpDBå·²æ”¯æŒçš„æ•°æ®æ ¼å¼åŠå®Œæˆçš„æ˜ å°„**


<table>
    <tr>
        <td><b>æ•°æ®æ ¼å¼</b></td>
        <td><b>æ’ä»¶åç§°</b> </td>
        <td><b>formatæ ‡è¯†</b></td>
        <td><b>æ˜ å°„å’Œè½¬åŒ–</b></td>
        <td><b>å¤‡æ³¨</b></td>
    </tr>
    <tr>
        <td rowspan="1">å†…å­˜ä¸­æ•°æ®</td>
        <td>æ— </td>
        <td>Dictï¼ŒList</td>
        <td>æ— </td>
        <td>æ— </td>
    </tr>
    <tr>
        <td rowspan="3">éç»“æ„åŒ–æ•°æ®</td>
        <td>plugin_gdskfile</td>
        <td>["gfile", "gdskfile"ï¼Œâ€œGDSKfileâ€]</td>
        <td>æ— ç•Œé™</td>
        <td>æ•°æ®ç›´æ¥è¯»å…¥å†…å­˜</td>
    </tr>
    <tr>
        <td>plugin_namelist </td>
        <td>["namelist"] </td>
        <td>æ— ç•Œé™</td>
        <td>æ•°æ®ç›´æ¥è¯»å…¥å†…å­˜</td>
    </tr>
    <tr>
        <td>......</td>
        <td>......</td>
        <td>......</td>
        <td>......</td>
    </tr>
    <tr>
        <td rowspan="5">åŠç»“æ„åŒ–æ•°æ®</td>
        <td>plugin_netcdf</td>
        <td>["nc", "netcdf", "NetCDf"]</td>
        <td>åˆ†å¼€</td>
        <td>å»¶è¿Ÿæ‰§è¡Œ</td>
    </tr>
    <tr>
        <td>plugin_hdf5 </td>
        <td>["h5", "hdf5", "HDF5"]</td>
        <td>åˆ†å¼€</td>
        <td>å»¶è¿Ÿæ‰§è¡Œ</td>
    </tr>
    <tr>
        <td>plugin_json</td>
        <td> ["json", "JSON"] Â </td>
        <td>åˆ†å¼€</td>
        <td>å»¶è¿Ÿæ‰§è¡Œ</td>
    </tr>
    <tr>
        <td>plugin_yaml </td>
        <td>["yaml", "YAML"] Â </td>
        <td>åˆ†å¼€</td>
        <td>å»¶è¿Ÿæ‰§è¡Œ</td>
    </tr>
    <tr>
        <td>plugin_xml</td>
        <td> ["xml"] </td>
        <td>åˆ†å¼€</td>
        <td>å»¶è¿Ÿæ‰§è¡Œ</td>
    </tr>
    <tr>
        <td rowspan="2">è¿œç¨‹æ•°æ®åº“ç³»ç»Ÿ</td>
        <td>plugin_mdsplus</td>
        <td>["mdsplus", "mds", "mds+", "MDSplus"]</td>
        <td>åˆ†å¼€</td>
        <td>wall,pf_active,tf,magnetics,eq</td>
    </tr>
    <tr>
        <td>......</td>
        <td>......</td>
        <td>......</td>
        <td>......</td>
    </tr>

</table>


### **å®‰è£…SpDB**
#### ShenMaé›†ç¾¤ä¸Šçš„**SpDB** æ¨¡å—
ç›®å‰ï¼ŒShenMaé›†ç¾¤å†…ï¼ˆservice108ï¼‰æœåŠ¡å™¨ä¸ŠSpDBæ¨¡å—æ˜¯å¯ç”¨çš„ã€‚ä½ èƒ½è¿è¡Œä¸‹é¢å‘½ä»¤ï¼ŒåŠ è½½å…¶ç¯å¢ƒï¼š


```python
module load spdm/0.0.0-foss-2022b
```

å¦å¤–ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨MDSplus åç«¯ï¼Œéœ€è¦loadï¼š


```python
module load MDSplus-Python/7.131.5-gfbf-2022b-Python-3.10.8
```

æµ‹è¯•å®‰è£…ï¼š


```python
python -c "import spdm; print(spdm.__version__)"
```

#### ä¸ªäººPythonç¯å¢ƒæœ¬åœ°å®‰è£…
æ¨èä½¿ç”¨ancondaç»´æŠ¤ä¸ªäººPythonç¯å¢ƒï¼ŒPythonç‰ˆæœ¬3.10+ã€‚
SpDBçš„å‘è¡ŒåŒ…å·²ä¸Šä¼ åœ¨pip ä»“åº“ä¸­ï¼Œè¿è¡Œpip installç›´æ¥å®‰è£…:


```python
pip install --upgrade pip
pip install spdm 
```

æˆ–è€…ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½æ‰“åŒ…å¥½çš„whlæºç åŒ…å®‰è£…ï¼š


```python
wget https://gitee.com/SimPla/SpDM/releases/tag/0.3.0-rc
pip install --upgrade pip
pip install spdm 
```

å¦‚æœpipå®‰è£…æŒ‡å®šäº†å®‰è£…ç›®å½•ï¼Œéœ€å…ˆæ·»åŠ å®‰è£…ç›®å½•åˆ°PYTHONPATHä¸­ã€‚å¦è€…åœ¨é»˜è®¤çš„~/.local/lib/ä¸‹é¢ï¼š


```python
export PYTHONPATH=${INSTALLPATH}/site-packages:${PYTHONPATH}
```

æµ‹è¯•ä½ çš„å®‰è£…ï¼š


```python
cd ~
python -c "import spdm; print(spdm.__version__)"
```

### **SpDB**ç”¨æ³•
#### **SpDB** è®¿é—®Pythonä¸­åŸç”Ÿæ•°æ®ç±»å‹è®¿é—®


```python
from spdm.data.Entry import open_entry
from spdm.utils.logger import logger
#ç¼ºå°‘ä¾‹å­ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

```

#### **SpDB** å¤„ç†Pythonä¸­éç»“æ„åŒ–æ•°æ®,å¦‚GDSKfileç­‰


```python
from spdm.data.File import File
from spdm.utils.logger import logger
from pathlib import Path
current_path = "/scratch/jupytertest/workspace_fytok/fytok_tutorial/tutorial"
### For NameList File
DATA_INPUT = current_path+"/data/"
with File(DATA_INPUT+"/g070754.05000", mode="r", format="GEQdsk") as fid:
    doc = fid.read()
    eq_test = doc.dump()
```


```python
#### eq_testæ˜¯Pythonä¸­çš„å­—å…¸ï¼Œå…¶keyéµå®ˆIMAS IDSçš„ç»„ç»‡ç»“æ„
eq_test.keys()
```




    dict_keys(['wall', 'equilibrium'])




```python
#### æŸ¥çœ‹equilibriumä¸­çš„æ•°æ®
eq_test["equilibrium"].keys()
```




    dict_keys(['time', 'vacuum_toroidal_field', 'time_slice'])



#### **SpDB** è®¿é—®Pythonä¸­åŠç»“æ„åŒ–æ•°æ®,å¦‚NameList,netCDF,HDF5ç­‰


```python
### åˆå§‹åŒ–ç¯å¢ƒ
from spdm.data.File import File
from spdm.utils.logger import logger
from pathlib import Path
current_path = "/scratch/jupytertest/workspace_fytok/fytok_tutorial/tutorial"
### For NameList File
DATA_INPUT = current_path+"/data/"
```

##### **NameList**æ–‡ä»¶


```python
###ä»¥GENRAYçš„è¾“å…¥æ–‡ä»¶genray.datä¸ºä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªNameListæ ¼å¼çš„æ–‡ä»¶ã€‚
with File(f"{DATA_INPUT}/genray.dat", format= "namelist" ,mode="r") as oid:
### ä»…ä»…å»ºç«‹é“¾æ¥ï¼Œè€Œæ²¡æœ‰æ‹¿å›æ•°æ®
    output_entry = oid.read()
### æ‹¿å›æ‰€æœ‰æ•°æ®
    output_data = oid.read().dump()
###è·å–namelistä¸­çš„å…³é”®å­—key
logger.info(output_data.keys())
### é€šè¿‡childè·å–æŸä¸ªå­èŠ‚ç‚¹çš„å€¼ï¼Œè€Œä¸éœ€è¦æŠŠæ•´ä¸ªæ ‘è¯»å›æ¥
logger.info(output_entry.child("main_lobes").__value__)
```

    [0;34m2023-11-11 14:04:56,391 [    spdm]     INFO: dict_keys(['main_lobes', 'genr', 'tokamak', 'wave', 'scatnper', 'dispers', 'numercl', 'output', 'plasma', 'species', 'varden', 'denprof', 'tpopprof', 'vflprof', 'zprof', 'tprof', 'grill', 'rz_launch_grill_tab', 'eccone', 'dentab', 'dentab_nonuniform_line', 'temtab', 'temtab_nonuniform_line', 'tpoptab', 'tpoptab_nonuniform_line', 'vflowtab', 'vflowtab_nonuniform_line', 'zeftab', 'zeftab_nonuniform_line', 'read_diskf', 'emission', 'ox', 'adj_nml', 'edge_prof_nml', 'lsc_approach_nml', 'edctsctab', 'jpartsctab'])[0m
    [0;34m2023-11-11 14:04:56,393 [    spdm]     INFO: OrderedDict([('total_grills', 5),
                 ('main_grills', 4),
                 ('bt_direction', 1),
                 ('power_fraction_factor', 0.8248)])[0m



```python
#### NotImplementedError: TODO: NAMELISTFile.write
# with File(f"{DATA_INPUT}/test-eq.h5", mode="w", format="namelist") as oid:
#     oid.write(eq_test)
```

##### **netCDF**æ–‡ä»¶


```python
### ä»¥GENRAYçš„å‰–é¢è¾“å…¥æ–‡ä»¶genray_profs_in.ncä¸ºä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªnetCDFæ ¼å¼çš„æ–‡ä»¶ã€‚
with File(f"{DATA_INPUT}/genray_profs_in.nc", format= "NetCDf" ,mode="r") as oid:
### ä»…ä»…å»ºç«‹é“¾æ¥ï¼Œè€Œæ²¡æœ‰æ‹¿å›æ•°æ®
    output_entry = oid.read()
### æ‹¿å›æ‰€æœ‰æ•°æ®
    output_data = oid.read().dump()
###è·å–namelistä¸­çš„å…³é”®å­—key
logger.info(output_data.keys())
logger.info(output_data["dmass"].data)
### é€šè¿‡childè·å–æŸä¸ªå­èŠ‚ç‚¹çš„å€¼ï¼Œè€Œä¸éœ€è¦æŠŠæ•´ä¸ªæ ‘è¯»å›æ¥
# logger.info(output_entry.child("dmass").__value__)
```

    [0;34m2023-11-11 14:30:54,238 [    spdm]     INFO: dict_keys(['charge', 'dmass', 'en', 'eqdsk_name', 'nj', 'nspecgr', 'r', 'temp', 'zeff', 'title'])[0m
    [0;34m2023-11-11 14:30:54,239 [    spdm]     INFO: [1.00000000e+00 1.83619995e+03 3.67239990e+03 2.20343994e+04][0m



```python
#### å†™.ncæ–‡ä»¶
with File(f"{DATA_INPUT}/test-eq.nc", mode="w", format="netcdf") as oid:
    oid.write(eq_test)
with File(f"{DATA_INPUT}/test-eq.nc", format= "NetCDf" ,mode="r") as oid: 
    test_data = oid.read().dump()
    logger.info(test_data.keys())
    logger.info(test_data["wall"])
```

    [0;34m2023-11-11 14:50:11,262 [    spdm]     INFO: dict_keys(['wall', 'equilibrium'])[0m
    [0;34m2023-11-11 14:50:11,263 [    spdm]     INFO: {'description_2d': {'0': {'limiter': {'unit': {'0': {'outline': {'r': array([1.35838, 1.35838, 1.35838, 1.36314, 1.4371 , 1.43721, 1.44164,
           1.4297 , 1.39169, 1.39151, 1.37929, 1.399  , 1.43623, 1.45919,
           1.47791, 1.54494, 1.61204, 1.63506, 1.66054, 1.66519, 1.6955 ,
           1.70668, 1.71388, 1.714  , 1.73649, 1.76324, 1.80199, 1.80237,
           1.93972, 1.97063, 2.07495, 2.1771 , 2.27925, 2.35   , 2.35   ,
           2.35   , 2.27925, 2.1771 , 2.07495, 1.9728 , 1.97063, 1.92059,
           1.87055, 1.82051, 1.79281, 1.76511, 1.75421, 1.67782, 1.60143,
           1.48426, 1.36709, 1.33132, 1.37874, 1.42615, 1.40528, 1.3844 ,
           1.36353, 1.35838, 1.35838, 1.35838, 1.35838]),
                                                                     'z': array([ 0.      ,  0.227   ,  0.454   ,  0.455735,  0.798332,  0.798821,
            0.838195,  0.908908,  1.01426 ,  1.01473 ,  1.04859 ,  1.03946 ,
            1.0256  ,  1.02095 ,  1.02514 ,  1.05454 ,  1.08394 ,  1.09586 ,
            1.114   ,  1.11765 ,  1.14183 ,  1.16211 ,  1.13093 ,  1.13044 ,
            1.033   ,  0.969832,  0.92567 ,  0.925347,  0.809223,  0.783389,
            0.68838 ,  0.58904 ,  0.4897  ,  0.49    ,  0.      , -0.49    ,
           -0.4897  , -0.58904 , -0.68838 , -0.78772 , -0.783389, -0.832375,
           -0.881361, -0.930347, -1.05034 , -1.17034 , -1.13917 , -1.03465 ,
           -0.930138, -0.95338 , -0.976622, -1.01072 , -0.879327, -0.747939,
           -0.65062 , -0.5533  , -0.455981, -0.454   , -0.227   ,  0.      ,
            0.      ])}}}}}}}[0m


##### **HDF5**æ–‡ä»¶


```python
### ä»¥testall.h5ï¼Œå®ƒæ˜¯ä¸€ä¸ªHDF5æ ¼å¼çš„æ–‡ä»¶ã€‚
with File(f"{DATA_INPUT}/testall.h5", format= "HDF5" ,mode="r") as oid:
### ä»…ä»…å»ºç«‹é“¾æ¥ï¼Œè€Œæ²¡æœ‰æ‹¿å›æ•°æ®
    output_entry = oid.read()
### æ‹¿å›æ‰€æœ‰æ•°æ®
    output_data = oid.read().dump()
###è·å–namelistä¸­çš„å…³é”®å­—key
logger.info(output_data.keys())
logger.info(output_data["coherent_wave"]["global_quantities"])

### é€šè¿‡childè·å–æŸä¸ªå­èŠ‚ç‚¹çš„å€¼ï¼Œè€Œä¸éœ€è¦æŠŠæ•´ä¸ªæ ‘è¯»å›æ¥
# logger.info(output_entry.child("coherent_wave.current_tor").__value__)
```

    [0;34m2023-11-11 14:36:42,362 [    spdm]     INFO: dict_keys(['coherent_wave'])[0m
    [0;34m2023-11-11 14:36:42,363 [    spdm]     INFO: {'current_tor': 461821.31203568814,
     'frequency': 4600000000.0,
     'power': 19375694355948.902}[0m



```python
#### å†™.ncæ–‡ä»¶
with File(f"{DATA_INPUT}/test-eq.hdf5", mode="w", format="HDF5") as oid:
    oid.write(eq_test)
with File(f"{DATA_INPUT}/test-eq.hdf5", format= "HDF5" ,mode="r") as oid: 
    test_data = oid.read().dump()
    logger.info(test_data.keys())
    logger.info(test_data["wall"])
```

    [0;34m2023-11-11 14:52:25,458 [    spdm]     INFO: dict_keys(['equilibrium', 'wall'])[0m
    [0;34m2023-11-11 14:52:25,459 [    spdm]     INFO: {'description_2d': [{'limiter': {'unit': [{'outline': {'r': array([1.35838, 1.35838, 1.35838, 1.36314, 1.4371 , 1.43721, 1.44164,
           1.4297 , 1.39169, 1.39151, 1.37929, 1.399  , 1.43623, 1.45919,
           1.47791, 1.54494, 1.61204, 1.63506, 1.66054, 1.66519, 1.6955 ,
           1.70668, 1.71388, 1.714  , 1.73649, 1.76324, 1.80199, 1.80237,
           1.93972, 1.97063, 2.07495, 2.1771 , 2.27925, 2.35   , 2.35   ,
           2.35   , 2.27925, 2.1771 , 2.07495, 1.9728 , 1.97063, 1.92059,
           1.87055, 1.82051, 1.79281, 1.76511, 1.75421, 1.67782, 1.60143,
           1.48426, 1.36709, 1.33132, 1.37874, 1.42615, 1.40528, 1.3844 ,
           1.36353, 1.35838, 1.35838, 1.35838, 1.35838]),
                                                           'z': array([ 0.      ,  0.227   ,  0.454   ,  0.455735,  0.798332,  0.798821,
            0.838195,  0.908908,  1.01426 ,  1.01473 ,  1.04859 ,  1.03946 ,
            1.0256  ,  1.02095 ,  1.02514 ,  1.05454 ,  1.08394 ,  1.09586 ,
            1.114   ,  1.11765 ,  1.14183 ,  1.16211 ,  1.13093 ,  1.13044 ,
            1.033   ,  0.969832,  0.92567 ,  0.925347,  0.809223,  0.783389,
            0.68838 ,  0.58904 ,  0.4897  ,  0.49    ,  0.      , -0.49    ,
           -0.4897  , -0.58904 , -0.68838 , -0.78772 , -0.783389, -0.832375,
           -0.881361, -0.930347, -1.05034 , -1.17034 , -1.13917 , -1.03465 ,
           -0.930138, -0.95338 , -0.976622, -1.01072 , -0.879327, -0.747939,
           -0.65062 , -0.5533  , -0.455981, -0.454   , -0.227   ,  0.      ,
            0.      ])}}]}}]}[0m


æ³¨ï¼šï¼ˆ1ï¼‰å…¶ä»–çš„åŠç»“æ„åŒ–æ•°æ®,YAML,JSONç­‰ï¼Œè®¿é—®å½¢å¼ç±»ä¼¼ã€‚

#### **SpDB**å¤„ç†è¿œç¨‹MDSplusæ•°æ®åº“ç³»ç»Ÿ

åœ¨**SpDB**ä¸­ï¼Œä½¿ç”¨open_entry()å»ºç«‹ç»Ÿä¸€çš„è®¿é—®å…¥å£,æ”¯æŒè¿œç¨‹MDSplus Serveræ•°æ®åº“çš„è®¿é—®ï¼ŒåŠæœ¬åœ°MDSplusçš„æ•°æ®åº“ä¸­æ•°æ®çš„è®¿é—®ã€‚æ”¯æŒä¸¤ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ï¼š

ï¼ˆ1ï¼‰**ä¸åŒæ•°æ®æºçš„è‡ªåŠ¨é›†æˆ**

SpDBä¸­æä¾›**open_entry**å»ºç«‹è®¿é—®é“¾æ¥ï¼Œ**wallï¼Œpfï¼Œtfï¼Œmagnetics**ç­‰è¢«æ˜ å°„çš„æ•°æ®å‡å¯ä»¥é€šè¿‡è¯¥é“¾æ¥å…¥å£è®¿é—®ã€‚æ•°æ®æºæ¥è‡ªäºé™æ€çš„XMLæ–‡ä»¶ï¼ŒåŠ¨æ€çš„MDSæ•°æ®åº“ä¸­çš„ä¸åŒtreeï¼šeast,pcs_east,efit_eastç­‰

SpDBä¸­æ•°æ®çš„è®¿é—®æ–¹å¼æ˜¯æŒ‰ç…§IDSçš„æ ‘çŠ¶ç»“æ„é€å±‚è®¿é—®ã€‚

ï¼ˆ2ï¼‰**â€œæ‡’æƒ°åŠ è½½â€æ•°æ®**

SpDBæ”¯æŒâ€æ‡’æƒ°åŠ è½½â€œæ•°æ®ï¼Œå› ä¸ºï¼ŒSpDBåå°å·²ç»è‡ªåŠ¨é›†æˆäº†ä¸åŒæ•°æ®æºçš„æ•°æ®ï¼Œå¯¹åº”äºä¸åŒçš„IDSæ¡ç›®ä¸­ã€‚æ‰€è¯·æ±‚çš„æ¡ç›®æˆ–è€…æŸä¸ªæ¡ç›®ä¸­å¯èƒ½å­˜å‚¨äº†å¤§é‡çš„æ•°æ®ï¼Œå¦‚æœè¯·æ±‚çš„æ—¶å€™ä¾¿ç«‹å³ä»åº•å±‚è®¿é—®å±‚åç«¯è¯»å–æ‰€æœ‰æ•°æ®ï¼Œå¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½åªéœ€è¦ä¸ªåˆ«çš„æ•°æ®å­é›†ï¼Œâ€æ‡’æƒ°åŠ è½½â€ä½¿å¾—ç”¨æˆ·ä»…ä»…å»ºç«‹é“¾æ¥ï¼Œåªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰çœŸæ­£è·å–æ•°æ®ï¼Œè¿™æ ·ä¼šåˆ©äºåŠ é€Ÿã€‚

- **.child()**æ“ä½œå¯ä»¥å°†é“¾æ¥æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ ‘èŠ‚ç‚¹ï¼Œå»ºç«‹æ–°çš„é“¾æ¥ï¼Œè€Œä¸ä¼šè·å–æ•°æ®
- **.get()**æ“ä½œåˆ™ç›´æ¥å°†è·å¾—å…¨éƒ¨æ•°æ®ã€‚

#### åŠ è½½åŸºæœ¬ç¯å¢ƒ


```python
### importåŸºæœ¬ç¯å¢ƒ
from spdm.data.Entry import open_entry
from spdm.utils.logger import logger
import fytok
import MDSplus
import os

### æŒ‡å®šmappingfileçš„è·¯å¾„
os.environ["SP_DATA_MAPPING_PATH"] = "${workdir}/fytok_data/mapping"
```

#### è®¿é—®è¿œç¨‹EAST MDSplusæ•°æ®åº“


```python
### è®¿é—®è¿œç¨‹EAST MDSæ•°æ®åº“ä¸­70754ç‚®çš„æ•°æ®ï¼Œ
shot_num = 70754
time_slice = 10
entry = open_entry("east+mdsplus://202.127.204.12?enable=efit_east&shot={shot_num}")
```

#### è®¿é—®è¿œç¨‹æœ¬åœ°MDSplusæ•°æ®åº“


```python
# ### è®¿é—®æœ¬åœ°MDSplusè·¯å¾„ä¸­ä¸­çš„70754ç‚®çš„æ•°æ®
shot_num = 70754
time_slice = 10
DATA_PATH = "/scratch/jupytertest/workspace_fytok/fytok_data"
entry = open_entry(f"east+mdsplus://{DATA_PATH}/mdsplus/~t/?shot=70745")
```

##### .child()æ”¯æŒâ€œæ‡’æƒ°æ‰§è¡Œâ€


```python
### .childæ“ä½œä¼šå°†é“¾æ¥è¿›ä¸€æ­¥æŒ‡å‘wall
wall = entry.child("wall")
### æ‰“å°wallçš„ç±»å‹ï¼Œä»ç„¶æ˜¯ä¸ªentry
type(wall)
```




    spdm.data.Entry.EntryProxy




```python
### ç»§ç»­ç§»åŠ¨é“¾æ¥åˆ°wallä¸­çš„ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ä¸­,outlineä»ç„¶æ˜¯ä¸ªentry
outline = entry.child("wall.description_2d[0].limiter.unit[0].outline")
### è·å–outlineçš„æ•°æ®
print(outline.__value__)
```

    {'r': array([2.277, 2.273, 2.267, 1.94 , 1.94 , 1.802, 1.773, 1.751, 1.736,
           1.714, 1.707, 1.696, 1.665, 1.656, 1.635, 1.612, 1.478, 1.459,
           1.44 , 1.436, 1.399, 1.379, 1.392, 1.43 , 1.439, 1.442, 1.437,
           1.363, 1.361, 1.361, 1.361, 1.363, 1.421, 1.423, 1.422, 1.418,
           1.331, 1.367, 1.564, 1.597, 1.598, 1.624, 1.754, 1.765, 1.814,
           1.824, 1.825, 1.841, 1.971, 1.971, 2.267, 2.273, 2.277, 2.277,
           2.306, 2.328, 2.343, 2.35 , 2.35 , 2.35 , 2.343, 2.328, 2.306,
           2.277]), 'z': array([ 0.485,  0.485,  0.493,  0.809,  0.809,  0.926,  0.956,  0.993,
            1.033,  1.131,  1.162,  1.142,  1.117,  1.111,  1.096,  1.084,
            1.025,  1.021,  1.024,  1.026,  1.039,  1.049,  1.014,  0.909,
            0.873,  0.835,  0.799,  0.456,  0.454,  0.   , -0.454, -0.456,
           -0.725, -0.748, -0.749, -0.77 , -1.011, -0.977, -0.938, -0.941,
           -0.941, -0.961, -1.139, -1.17 , -0.959, -0.934, -0.932, -0.91 ,
           -0.783, -0.783, -0.493, -0.485, -0.485, -0.309, -0.244, -0.176,
           -0.106, -0.036,  0.   ,  0.036,  0.106,  0.176,  0.244,  0.309])}


##### .get()ç›´æ¥è·å–æ•°æ®


```python
###.get()æ“ä½œç›´æ¥è·å–æ•°æ®ï¼Œä»¥dictå­—å…¸çš„å½¢å¼è¿”å›
entry.get("wall")
```




    {'ids_properties': {'comment': {},
      'provider': 'Guo, Yong',
      'creation_date': '2020-10-12',
      'homogeneous_time': 2},
     'description_2d': {'type': {'name': 'equilibrium', 'index': 1},
      'limiter': {'type': {'name': 'limiter', 'index': 0},
       'unit': {'name': 'limiter',
        'closed': 1,
        'outline': {'r': array([2.277, 2.273, 2.267, 1.94 , 1.94 , 1.802, 1.773, 1.751, 1.736,
                1.714, 1.707, 1.696, 1.665, 1.656, 1.635, 1.612, 1.478, 1.459,
                1.44 , 1.436, 1.399, 1.379, 1.392, 1.43 , 1.439, 1.442, 1.437,
                1.363, 1.361, 1.361, 1.361, 1.363, 1.421, 1.423, 1.422, 1.418,
                1.331, 1.367, 1.564, 1.597, 1.598, 1.624, 1.754, 1.765, 1.814,
                1.824, 1.825, 1.841, 1.971, 1.971, 2.267, 2.273, 2.277, 2.277,
                2.306, 2.328, 2.343, 2.35 , 2.35 , 2.35 , 2.343, 2.328, 2.306,
                2.277]),
         'z': array([ 0.485,  0.485,  0.493,  0.809,  0.809,  0.926,  0.956,  0.993,
                 1.033,  1.131,  1.162,  1.142,  1.117,  1.111,  1.096,  1.084,
                 1.025,  1.021,  1.024,  1.026,  1.039,  1.049,  1.014,  0.909,
                 0.873,  0.835,  0.799,  0.456,  0.454,  0.   , -0.454, -0.456,
                -0.725, -0.748, -0.749, -0.77 , -1.011, -0.977, -0.938, -0.941,
                -0.941, -0.961, -1.139, -1.17 , -0.959, -0.934, -0.932, -0.91 ,
                -0.783, -0.783, -0.493, -0.485, -0.485, -0.309, -0.244, -0.176,
                -0.106, -0.036,  0.   ,  0.036,  0.106,  0.176,  0.244,  0.309])},
        '@id': '0'}},
      'vessel': {'unit': {'name': 'EAST',
        'identifier': 'EAST',
        'annular': {'outline_inner': {'closed': 1,
          'r': array([2.7286, 2.7069, 2.664 , 2.6007, 2.5178, 2.417 , 2.2997, 2.1681,
                 2.0244, 1.8708, 1.709 , 1.5435, 1.3902, 1.2814, 1.2402, 1.237 ,
                 1.237 , 1.237 , 1.237 , 1.237 , 1.237 , 1.237 , 1.237 , 1.237 ,
                 1.237 , 1.2402, 1.2814, 1.3902, 1.5435, 1.709 , 1.8708, 2.0244,
                 2.1681, 2.2997, 2.417 , 2.5178, 2.6007, 2.664 , 2.7069, 2.7286]),
          'z': array([ 0.083289,  0.24846 ,  0.40942 ,  0.56347 ,  0.708   ,  0.84058 ,
                  0.95892 ,  1.061   ,  1.1452  ,  1.2095  ,  1.2454  ,  1.2439  ,
                  1.1907  ,  1.075   ,  0.91857 ,  0.75173 ,  0.58468 ,  0.41763 ,
                  0.25058 ,  0.083526, -0.083526, -0.25058 , -0.41763 , -0.58468 ,
                 -0.75173 , -0.91857 , -1.075   , -1.1907  , -1.2439  , -1.2454  ,
                 -1.2095  , -1.1452  , -1.061   , -0.95892 , -0.84058 , -0.708   ,
                 -0.56347 , -0.40942 , -0.24846 , -0.083289])},
         'outline_outer': {'closed': 1,
          'r': array([2.844 , 2.8204, 2.7737, 2.7046, 2.6143, 2.5045, 2.3771, 2.2343,
                 2.0786, 1.9127, 1.7389, 1.5637, 1.3995, 1.2722, 1.2108, 1.199 ,
                 1.199 , 1.199 , 1.199 , 1.199 , 1.199 , 1.199 , 1.199 , 1.199 ,
                 1.199 , 1.2108, 1.2722, 1.3995, 1.5637, 1.7389, 1.9127, 2.0786,
                 2.2343, 2.3771, 2.5045, 2.6143, 2.7046, 2.7737, 2.8204, 2.844 ]),
          'z': array([ 0.089216,  0.26608 ,  0.43828 ,  0.6028  ,  0.75671 ,  0.89735 ,
                  1.0223  ,  1.1292  ,  1.2164  ,  1.282   ,  1.3197  ,  1.3165  ,
                  1.2605  ,  1.1444  ,  0.98288 ,  0.80532 ,  0.62636 ,  0.4474  ,
                  0.26844 ,  0.08948 , -0.08948 , -0.26844 , -0.4474  , -0.62636 ,
                 -0.80532 , -0.98288 , -1.1444  , -1.2605  , -1.3165  , -1.3197  ,
                 -1.282   , -1.2164  , -1.1292  , -1.0223  , -0.89735 , -0.75671 ,
                 -0.6028  , -0.43828 , -0.26608 , -0.089216])}},
        '@id': '0'}},
      '@id': '0'}}



##### SpDBä¸­æ•°æ®ä»¥å­—å…¸å½¢å¼åœ¨å†…å­˜ä¸­ç›´æ¥äº¤äº’


```python
### æ‰“å°IDS magneticsä¸­çš„å…³é”®keys
shot_num = 70754
time_slice = 10
DATA_PATH = "/scratch/jupytertest/workspace_fytok/fytok_data"
entry = open_entry(f"east+mdsplus://{DATA_PATH}/mdsplus/~t/?shot=70745")
entry.get("magnetics]").keys()

```




    dict_keys(['ids_properties', 'b_field_pol_probe', 'flux_loop', 'ip'])



##### SpDBä¸­listçš„è®¿é—®


```python
### ä¾‹å¦‚ï¼Œb_field_pol_probeæ¢é’ˆæœ‰å¤šä¸ªï¼Œä»¥listå½¢å¼å­˜åœ¨
type(entry.get("magnetics")["b_field_pol_probe"])

```




    list




```python

### æ¯ä¸ªæ¢é’ˆä¸‹é¢æ˜¯ä¸€ä¸ªå­—å…¸ç»“æ„ï¼Œè·å¾—å…¶keys
entry.get("magnetics.b_field_pol_probe[0]").keys()

```




    dict_keys(['name', 'identifier', 'position', 'toroidal_angle', 'field', '@id'])




```python

entry.child("magnetics.b_field_pol_probe[0].position").__value__
```




    [{'r': 1.2905, 'z': 0.0, '@id': '*'}]



##### SpDBä¸­æ•°æ®æŒ‰ç…§æ ‘çŠ¶ç»“æ„å±‚å±‚è®¿é—®


```python
### SpDBä¸­æ•°æ®æŒ‰ç…§å±‚å±‚è·¯å¾„è¿›è¡Œè®¿é—®:wall.description_2d[0].limiter.unit.outlin
### è·å–outlineçš„æ•°æ®ï¼š
entry.get("wall.description_2d[0].limiter.unit.outline")
```




    {'r': array([2.277, 2.273, 2.267, 1.94 , 1.94 , 1.802, 1.773, 1.751, 1.736,
            1.714, 1.707, 1.696, 1.665, 1.656, 1.635, 1.612, 1.478, 1.459,
            1.44 , 1.436, 1.399, 1.379, 1.392, 1.43 , 1.439, 1.442, 1.437,
            1.363, 1.361, 1.361, 1.361, 1.363, 1.421, 1.423, 1.422, 1.418,
            1.331, 1.367, 1.564, 1.597, 1.598, 1.624, 1.754, 1.765, 1.814,
            1.824, 1.825, 1.841, 1.971, 1.971, 2.267, 2.273, 2.277, 2.277,
            2.306, 2.328, 2.343, 2.35 , 2.35 , 2.35 , 2.343, 2.328, 2.306,
            2.277]),
     'z': array([ 0.485,  0.485,  0.493,  0.809,  0.809,  0.926,  0.956,  0.993,
             1.033,  1.131,  1.162,  1.142,  1.117,  1.111,  1.096,  1.084,
             1.025,  1.021,  1.024,  1.026,  1.039,  1.049,  1.014,  0.909,
             0.873,  0.835,  0.799,  0.456,  0.454,  0.   , -0.454, -0.456,
            -0.725, -0.748, -0.749, -0.77 , -1.011, -0.977, -0.938, -0.941,
            -0.941, -0.961, -1.139, -1.17 , -0.959, -0.934, -0.932, -0.91 ,
            -0.783, -0.783, -0.493, -0.485, -0.485, -0.309, -0.244, -0.176,
            -0.106, -0.036,  0.   ,  0.036,  0.106,  0.176,  0.244,  0.309])}



#####  å†™GDSDKfileæ–‡ä»¶ï¼ˆå¾…ç¡®è®¤ï¼‰


```python
# shot_num = 70754

# time_slice = 10

# OUTPUT_PATH ="/scratch/jupytertest/workspace_fytok/output"
# entry = open_entry(f"east+mdsplus://202.127.204.12?enable=efit_east&shot={shot_num}")

# data = {
#     "wall": entry.child(f"wall"),
#     "equilibrium": {"time_slice": [entry.child(f"equilibrium/time_slice/{time_slice}")]}
# }

# with File(f"{OUTPUT_PATH}/g{shot_num}.gfile", mode="w", format="geqdsk") as fid:
#     fid.write(data, description="equilibrium")
```
